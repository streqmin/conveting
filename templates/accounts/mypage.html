<h2>마이페이지</h2>
<p>
    <strong>가입 방식:</strong> {{ user.get_social_type_display }}
</p>
<p>
    <strong>가입일:</strong> {{ user.created_at|date:"Y년 m월 d일 H:i" }}
</p>
{% if user.profile_image %}<img src="{{ user.profile_image.url }}" alt="프로필 이미지" style="width: 120px" />{% endif %}
<hr>
<form method="post" enctype="multipart/form-data">
    {% csrf_token %}
    {% if is_edit_mode %}
        <div>
            {{ form.username.label_tag }}
            <br />
            {{ form.username }}
        </div>
        <div>
            {{ form.email.label_tag }}
            <br />
            {{ form.email }}
        </div>
        <div>
            {{ form.profile_image.label_tag }}
            <br />
            {{ form.profile_image }}
        </div>
        <button type="submit">저장</button>
    {% else %}
        <p>
            <strong>사용자명:</strong> {{ user.username }}
        </p>
        <p>
            <strong>이메일:</strong> {{ user.email|default:"-" }}
        </p>
        <a href="?edit=true">
            <button type="button">수정하기</button>
        </a>
    {% endif %}
    <hr>
    <h3>반려견 목록</h3>
    {% if dogs %}
        <ul>
            {% for dog in dogs %}
                <li style="margin-bottom: 20px">
                    <a href="{% url 'dog_detail' pk=dog.id %}"
                       style="text-decoration: none;
                              color: inherit">
                        <p>
                            <strong>이름:</strong> {{ dog.name }}
                        </p>
                        <p>
                            <strong>나이:</strong> {{ dog.age|default:"-" }}살
                        </p>
                        <p>
                            <strong>견종:</strong> {{ dog.breed }}
                        </p>
                        {% if dog.photo %}
                            <img src="{{ dog.photo.url }}"
                                 alt="반려견 사진"
                                 style="width: 120px;
                                        border: 1px solid #ccc" />
                        {% endif %}
                    </a>
                </li>
            {% endfor %}
        </ul>
    {% else %}
        <p>등록된 반려견이 없습니다.</p>
    {% endif %}
    <hr>
    <h3>최근 예측 결과</h3>
    {% if predictions %}
        <div style="display: flex; flex-wrap: wrap; gap: 16px;">
            {% for group in predictions %}
                <a href="{% url 'prediction_result' request_id=group.request_id %}"
                   style="text-decoration: none;
                          color: inherit">
                    <div style="border: 1px solid #ccc;
                                padding: 12px;
                                width: 280px;
                                border-radius: 8px">
                        <img src="{{ group.image }}"
                             alt="예측 이미지"
                             style="width: 100px;
                                    height: 100px;
                                    object-fit: cover;
                                    border-radius: 8px;
                                    border: 1px solid #ccc" />
                        <p>
                            <strong>반려견:</strong> {{ group.dog_name }}
                        </p>
                        {% for pred in group.results %}
                            <p>
                                <strong>질환:</strong> {{ pred.predicted_disease.name }}
                                <br />
                                <strong>확률:</strong> {{ pred.probability|floatformat:2 }}
                                <br />
                                <strong>정상 여부:</strong>
                                {% if pred.is_normal %}
                                    정상
                                {% else %}
                                    이상
                                {% endif %}
                            </p>
                            {% if not forloop.last %}<hr style="border: none; border-top: 1px dashed #aaa;" />{% endif %}
                        {% endfor %}
                    </div>
                </a>
            {% endfor %}
        </div>
    {% else %}
        <p>아직 예측한 기록이 없습니다.</p>
    {% endif %}
</form>
